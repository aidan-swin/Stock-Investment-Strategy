{% extends "base.html" %}
{% block title%}Home{% endblock %}

{% block content %}
  <style>
    .container {
      margin-top: 20px;
		  width: 98%; 
      max-width: 1400px; 
      background-color: #fff;
      padding: 20px;
      border-radius: 5px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }
    .card-header {
      background-color: rgb(208, 35, 35);
      text-align: center;
      color: white;
    }
    .btn-primary {
      background-color: rgb(208, 35, 35)!important;
      color: #fff;
      border: none;
      border-radius: 5px;
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
    }
    .btn-primary:hover {  
      background-color: rgb(175, 46, 46)!important;
    }
    .red-themed {
    background-color: rgb(208, 35, 35);
    color: white; /* Text color to ensure readability on a red background */
    } 

  </style>

<body>
  <div class="content">
    <div class = "container">
      <form method="post">
        <div class ="card-header">
          <h5>Add Company Info</h2>
        </div>
        <div class="card-body table-responsive table-hover">
        <table id="example" class="table table-striped">
          <thead>
              <tr>
                  <th>Select</th> <!-- New column for radio buttons -->
                  <th>Code</th>
                  <th>Company Name</th>
                  <th>City</th>
                  <th>Industry</th>
                  <th>Sector</th>
                  <th>Action</th>
              </tr>
          </thead>
          <tbody>
              {% for stock in stocks %}
              <tr>
                  <td>
                      <div class="form-check">
                          <input class="form-check-input" type="radio" name="stock" value="{{ stock.stock_code }}" required>
                      </div>
                    </div>
                  </td>
                  <td>{{ stock.stock_code }}</td>
                  <td>{{ stock.stock_name }}</td>
                  <td>{{ stock.city }}</td>
                  <td>{{ stock.industry }}</td>
                  <td>{{ stock.sector }}</td>
                  <td>
                      <a href="{{ url_for('views.detail', id=stock.stock_code) }}" class="btn btn-primary">View</a>
                  </td>
              </tr>
              {% endfor %}
          </tbody>
          </table>
          <br>
          <br>
    <!-- First rows of inputs -->
      <div class = "form-group">
        <div class = "form-row">
          <div class = "col">
              <label for="ER">Unit Quantity:</label>
              <div class="input-group">
                <div class="input-group-prepend">
                  <span class="input-group-text">ðŸ”¢</span>
                </div>
                <input type="number" class="form-control" id="unit_quantity" name="unit_quantity" step="1" placeholder="Enter Unit Quantity" required>
              </div>
          </div>
          <div class="col">
              <label for="LC">Purchase Date:</label>
              <div class="input-group">
                <div class="input-group-prepend">
                  <span class="input-group-text">ðŸ“…</span>
                </div>
                <input type="date" class="form-control" id="date" name="purchase_date" max="{{ max_date }}" required>
              </div>
          </div>
        </div>
      </div>
        <div class = "form-group">
          <div class = "form-row">
            <div class = "col">
              <button type="submit" class="btn btn-primary">Submit</button>
            </div>
          </div>
        </form>
        <br>
        <br>
        <p>For additional information on the fields, click <a href="{{ url_for('views.show_information') }}">here.</a> </p>
      </div>
    </div>
    
  </div>
          <!-- Chart code -->
          <div class="container" style="margin-top: 200px; text-align: center;">
            <div class="chart-container" style="display: inline-block; width: fit-content; height: fit-content;">
              <canvas id="LineChart" width="1400" height="500"></canvas>
            </div>
    <br>
    <button class="btn btn-primary" style="width: 100px;" onclick="timeFrame(this)" value="day">Day</button>
    <button class="btn btn-primary" style="width: 100px;" onclick="timeFrame(this)" value="week">Week</button>
    <button class="btn btn-primary" style="width: 100px;" onclick="timeFrame(this)" value="month">Month</button>
    <br><br><br>
    <table id="example2" class="table table-striped table-hover">
      <thead>
          <tr>
              <th class="red-themed">Code</th>
              <th class="red-themed">Name</th>
              <th class="red-themed">Unit Quantity</th>
              <th class="red-themed">Purchase Date</th>
              <th class="red-themed">Purchase Price</th>
              <th class="red-themed">Selling Price</th>
              <th class="red-themed">Price Difference</th>
              <th class="red-themed">Price Percentage</th>
              <th class="red-themed">Dividend Amount</th>
              <th class="red-themed">Dividend Yield</th>
              <th class="red-themed">Action</th>
          </tr>
      </thead>
      <tbody>
          {% for portfolio, calculation_result in portfolio_and_calculation_results %}
          <tr>
              <td>{{ portfolio[0].stock_code }}</td> {# Access the stock_code attribute of the Portfolio object in the tuple. #}
              <td>{{ portfolio[1] }}</td> {# Access the stock_name directly from the tuple. #}
              <td>{{ portfolio[0].unitQuantity }}</td> {# Access the unitQuantity attribute of the Portfolio object in the tuple. #}
              <td>{{ portfolio[0].purchaseDate }}</td> {# Access the purchaseDate attribute of the Portfolio object in the tuple. #}
              <td>{{ calculation_result.purchase_price }}</td>
              <td>{{ calculation_result.selling_price }}</td>
              <td>{{ calculation_result.price_diff }}</td>
              <td>{{ calculation_result.price_perc }}</td>
              <td>{{ calculation_result.dividend_amount }}</td>
              <td>{{ calculation_result.dividend_yield }}</td>
              <td>
                <form method="POST" action="/delete_portfolio/{{ portfolio[0].id }}">
                    <button type="submit" class="btn btn-danger">Delete</button>
                </form>
            </td>
          </tr>
          {% endfor %}
      </tbody>
  </table>
  
    
          <form method="POST" action="/export_csv">
            <input type="hidden" id="tableData" name="table_data" value="">
            <button type="submit" class="btn btn-primary" id="exportButton">Export to CSV</button>
          </div>    

</body>
<script type="text/javascript">
  $(document).ready(function() {
    // Initialize DataTables
    var table = $('#example').DataTable();

    // Store the selected stock code 
    var selectedStockCode = null;

    // Listen for changes in the radio buttons
    $('#example tbody').on('change', 'input[type="radio"]', function() {
      var radio = $(this);
      var stockCode = radio.val();

      // Update the selectedStockCode variable
      selectedStockCode = stockCode;

      // Update radio buttons in all rows
      $('input[type="radio"]', table.rows().nodes()).prop('checked', false);
      radio.prop('checked', true);
    });

    // Handle form submission or other actions with selectedStockCode
    $('#your-form').on('submit', function(e) {
      // Access selectedStockCode for the selected stock code
      if (selectedStockCode) {
        // Include the selectedStockCode in your form data or perform other actions
        console.log('Selected Stock Code:', selectedStockCode);
      } else {
        alert('Please select a stock.');
        e.preventDefault(); // Prevent form submission if no stock is selected
      }
    });
  });
</script>
<script type="text/javascript">
  $(document).ready(function() {
      $('#example2').DataTable();
  });
</script>
<script>
document.getElementById('exportButton').addEventListener('click', function() {
    var tableData = 'stock_code,stock_name,unitQuantity,purchaseDate,purchasePrice,sellingPrice,priceDifference,pricePercentage,dividendAmount,dividendYield\n';

    var table2 = $('#example2').DataTable();
    table2.rows().every(function() {
        var data = this.data();
        // Exclude the last column (containing the delete button)
        data.splice(-1, 1);
        tableData += data.join(',') + '\n'; // Append the data to the tableData
    });

    document.getElementById('tableData').value = tableData;
});

</script>
{% endblock %}