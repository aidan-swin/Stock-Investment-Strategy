{% extends "base.html" %}
{% block title %}Details for Company{% endblock %}

{% block content %}
<head>
  <style>
    .chart-box {
      max-width: max-content;
      min-width: fit-content;
      width: 100%;
    }
    .chart-container {
      margin: 10px;
      display: flex;
      justify-content: center;
      align-items: center;
      height: fit-content;
      min-width: fit-content;
      max-width: auto; 
    }
    .title{
      text-align: center;
      font-weight: bold;
    }
    .container{
      padding-top: 20px;
      min-width: fit-content; 
      max-width: 1350px;
    }
    .card-header {
      background-color: rgb(208, 35, 35);
      text-align: center;
      color: white;
    }
    .box-container {
      background-color: white;
      padding: 20px;
    }
    .btn-danger{
      margin-top: 20px;
    }
    .red-themed {
    background-color: rgb(208, 35, 35);
    color: white; /* Text color to ensure readability on a red background */
    } 
  </style>
</head>

<body>
  <div class="content">
    <div class="container">
      <div class="row">
        <div class="col">
          <div class="card-header">
            <h5>Details of {{company.stock_name}}</h5>
          </div>
            <!-- Top Chart Code -->
            <!-- Chart 1 -->
            <div class="box-container text-center" style="margin-bottom: 15px;">
              <div class="chart-container d-inline-block">
                <canvas id="myChart" width="400" height="350"></canvas>
              </div>
            <!-- Chart 2 -->
            <div class="chart-container d-inline-block">
              <canvas id="radarChart" width="600" height="350"></canvas>
            </div>
          </div>
        </div>
      </div>
      <!-- Company name -->
      <div class="form-group">
        <div class="row">
          <!-- Equity Ratio -->
          <div class="col">
            <label for="ER">Company Name:</label>
            <div class="input-group">
              <div class="input-group-prepend">
                <span class="input-group-text">üëî</span>
              </div>
              <input type="text" class="form-control" id="ER" name="ER" min="0" step="0.000000001" placeholder="Enter Company's Equity Ratio" value="{{company.stock_name}}" disabled>
            </div>
          </div>
          </div>
          </div>
      <!-- First row of display -->
      <div class="form-group">
        <div class="row">
          <!-- Equity Ratio -->
          <div class="col">
            <label for="ER">Earnings Per Share:</label>
            <div class="input-group">
              <div class="input-group-prepend">
                <span class="input-group-text">üí∞</span>
              </div>
              <input type="text" class="form-control" id="ER" name="ER" min="0" step="0.000000001" placeholder="Enter Company's Equity Ratio" value="{{ratios.rEPS}}" disabled>
            </div>
          </div>
          <!-- Liabilities Coverage -->
          <div class="col">
            <label for="LC">Price to Earnings:</label>
              <div class="input-group">
                <div class="input-group-prepend">
                  <span class="input-group-text">üìà</span>
                </div>
                <input type="text" class="form-control" id="LC" name="LC" min="0" step="0.000000001" placeholder="Enter Company's Liabilities Coverage" value="{{ratios.rPE}}" disabled>
              </div>
          </div>
          <!-- Net profit to Inventory -->
          <div class="col">
            <label for="NPTI">Return on Equity:</label>
              <div class="input-group">
                <div class="input-group-prepend">
                  <span class="input-group-text">üíπ</span>
                </div>
                <input type="text" class="form-control" id="NPTI" name="NPTI" min="0" step="0.000000001" placeholder="Enter Company's Net Profit To Inventory" value="{{ratios.rROE}}" disabled>
              </div>
          </div>
        </div>
    </div>
        <!-- Third row of display -->
        <div class="form-group">
          <div class="row">
            <!-- current_assets_without_inventories_to_long_term_liabilities -->
            <div class="col">
              <label for="CAWITL">Operating Margins:</label>
              <div class="input-group">
                <div class="input-group-prepend">
                  <span class="input-group-text">üè≠</span>
                </div>
                <input type="text" class="form-control" id="CAWITL" name="CAWITL" min="0" step="0.000000001" placeholder="Enter Company's Current Assets Without Inventories To Liabilities" value="{{ratios.rOM}}" disabled>
              </div>
            </div>
            <!-- current_liabilities_by_365_by_cost_of_products_sold -->
            <div class="col">
              <label for="CL365">Free Cash Flow:</label>
              <div class="input-group">
                <div class="input-group-prepend">
                  <span class="input-group-text">üí∏</span>
                </div>
                <input type="text" class="form-control" id="CL365" name="CL365" min="0" step="0.000000001" placeholder="Enter Company's Current Liabilities Of 365 Days By Cost Of Products Sold" value="{{ratios.rCF}}" disabled>
              </div>
            </div>
          </div>
        </div>
        <!-- Fourth row of display -->
        <div class="form-group">
          <div class="row">
            <!-- assets_without_inventories_and_short_term_liabilities_to_sales_without_gross_profit_and_depreciation -->
            <div class="col">
              <label for="AISTL">Dividend Yield:</label>
              <div class="input-group">
                <div class="input-group-prepend">
                  <span class="input-group-text">üìä</span>
                </div>
                <input type="text" class="form-control" id="AISTL" name="AISTL" min="0" step="0.000000001" placeholder="Enter Company's Assets w/o Inventories & Short Term Liabilities To Sales (w/o Gross Profit and Depreciation)" value="{{ratios.rDY}}" disabled>
              </div>
            </div>
            <!-- liability_to_operating_profit_ratio_per_day -->
            <div class="col">
              <label for="LTOPR">Payout Ratio:</label>
              <div class="input-group">
                <div class="input-group-prepend">
                  <span class="input-group-text">üìä</span>
                </div>
                <input type="text" class="form-control" id="LTOPR" name="LTOPR" min="0" step="0.000000001" placeholder="Enter Company's Liability To Operating Profit Ratio Per Day" value="{{ratios.rPR}}" disabled>
              </div>
          </div>
        </div>
      </div>
      <!-- Chart code -->
      <div class="box-container" style="margin-top: 20px; text-align: center;">
        <div class="chart-container" style="display: inline-block; width: fit-content; height: fit-content;">
          <canvas id="LineChart" width="700" height="300"></canvas>
        </div>
        <table id="example" class="table table-striped">
          <thead>
              <tr>
                <th class="red-themed">Date</th>
                <th class="red-themed">Open</th>
                <th class="red-themed">High</th>
                <th class="red-themed">Low</th>
                <th class="red-themed">Close</th>
                <th class="red-themed">Volume</th>  
              </tr>
          </thead>
          <tbody>
              {% for price in prices %}
              <tr>
                  <td>{{price.Date}}</td>
                  <td>{{price.Open}}</td>
                  <td>{{price.High}}</td>
                  <td>{{price.Low}}</td>
                  <td>{{price.Close}}</td>
                  <td>{{price.Volume}}</td>
              </tr>
              {% endfor %}
          </tbody>
      </table>
      </div>    
      <br>
      <!-- Company name -->
      <div class="form-group">
          <div class="form-group">
            <label for="Companyname">Company Name:</label>
            <div class="input-group">
            <div class="input-group-prepend">
            <span class="input-group-text">üëî</span>
          </div>
            <input type="text" class="form-control" id="Companyname" name="Companyname" placeholder="Enter Company Name" value="{{company.stock_name}} ({{company.stock_code}})" disabled>
          </div>
      </div>
      <!-- First row of display -->
      <div class="form-group">
        <div class="row">
          <div class="col">
            <label for="ER">Address 1:</label>
            <div class="input-group">
              <div class="input-group-prepend">
                <span class="input-group-text">üè†</span>
              </div>
              <input type="text" class="form-control" id="ER" name="ER" min="0" step="0.000000001" placeholder="Enter Company's Equity Ratio" value="{{company.address1}}" disabled>
            </div>
          </div>
          <!-- Liabilities Coverage -->
          <div class="col">
            <label for="LC">Address 2:</label>
              <div class="input-group">
                <div class="input-group-prepend">
                  <span class="input-group-text">üè†</span>
                </div>
                <input type="text" class="form-control" id="LC" name="LC" min="0" step="0.000000001" placeholder="Enter Company's Liabilities Coverage" value="{{company.address2}}" disabled>
              </div>
          </div>
        </div>
    </div>
           <!-- Third row of display -->
           <div class="form-group">
            <div class="row">
          <!-- Net profit to Inventory -->
            <div class="col">
              <label for="NPTI">City:</label>
                <div class="input-group">
                  <div class="input-group-prepend">
                    <span class="input-group-text">üèô</span>
                  </div>
                  <input type="text" class="form-control" id="NPTI" name="NPTI" min="0" step="0.000000001" placeholder="Enter Company's Net Profit To Inventory" value="{{company.city}}" disabled>
                </div>
            </div>
              <!-- current_assets_without_inventories_to_long_term_liabilities -->
              <div class="col">
                <label for="CAWITL">Zip Code:</label>
                <div class="input-group">
                  <div class="input-group-prepend">
                    <span class="input-group-text">üì¨</span>
                  </div>
                  <input type="text" class="form-control" id="CAWITL" name="CAWITL" min="0" step="0.000000001" placeholder="Enter Company's Current Assets Without Inventories To Liabilities" value="{{company.zip}}" disabled>
                </div>
              </div>
              <!-- current_liabilities_by_365_by_cost_of_products_sold -->
              <div class="col">
                <label for="CL365">Phone:</label>
                <div class="input-group">
                  <div class="input-group-prepend">
                    <span class="input-group-text">üìû</span>
                  </div>
                  <input type="text" class="form-control" id="CL365" name="CL365" min="0" step="0.000000001" placeholder="Enter Company's Current Liabilities Of 365 Days By Cost Of Products Sold" value="+{{company.phone}}" disabled>
                </div>
              </div>
            </div>
          </div>
        <!-- Fourth row of display -->
        <div class="form-group">
          <div class="row">
            <!-- assets_without_inventories_and_short_term_liabilities_to_sales_without_gross_profit_and_depreciation -->
            <div class="col">
              <label for="AISTL">Industry:</label>
              <div class="input-group">
                <div class="input-group-prepend">
                  <span class="input-group-text">üè≠</span>
                </div>
                <input type="text" class="form-control" id="AISTL" name="AISTL" min="0" step="0.000000001" placeholder="Enter Company's Assets w/o Inventories & Short Term Liabilities To Sales (w/o Gross Profit and Depreciation)" value="{{company.industry}}" disabled>
              </div>
            </div>
            <!-- liability_to_operating_profit_ratio_per_day -->
            <div class="col">
              <label for="LTOPR">Sector:</label>
              <div class="input-group">
                <div class="input-group-prepend">
                  <span class="input-group-text">üìä</span>
                </div>
                <input type="text" class="form-control" id="LTOPR" name="LTOPR" min="0" step="0.000000001" placeholder="Enter Company's Liability To Operating Profit Ratio Per Day" value="{{company.sector}}" disabled>
              </div>
          </div>
        </div>
      </div>
                       <!-- Third row of display -->
                       <div class="form-group">
                        <div class="row">
                      <!-- Net profit to Inventory -->
                        <div class="col">
                          <label for="NPTI">Website:</label>
                            <div class="input-group">
                              <div class="input-group-prepend">
                                <span class="input-group-text">üåê</span>
                              </div>
                              <input type="text" class="form-control" id="NPTI" name="NPTI" min="0" step="0.000000001" placeholder="Enter Company's Net Profit To Inventory" value="{{company.website}}" disabled>
                            </div>
                        </div>
                          <!-- current_assets_without_inventories_to_long_term_liabilities -->
                          <div class="col">
                            <label for="CAWITL">Number of Employees:</label>
                            <div class="input-group">
                              <div class="input-group-prepend">
                                <span class="input-group-text">üë•</span>
                              </div>
                              <input type="text" class="form-control" id="CAWITL" name="CAWITL" min="0" step="0.000000001" placeholder="Enter Company's Current Assets Without Inventories To Liabilities" value="{{company.fullTimeEmployees}}" disabled>
                            </div>
                          </div>
                          <!-- current_liabilities_by_365_by_cost_of_products_sold -->
                      </div>
                    <!-- Fourth row of display -->
</div>
    </div>
    
      <!-- Button code -->
      {% if user.admin_user == True %}
<!-- Button code -->
<div class="text-center">
  <form method="POST" action="/add_to_watchlist/{{ company.stock_code }}">
      <input type="hidden" name="stock_code" value="{{ company.stock_code }}">
      <input type="hidden" name="user_id" value="{{ user.id }}">
      {% if is_in_watchlist %}
          <button class="btn btn-danger" type="submit">Remove from Watch List</button>
      {% else %}
          <button class="btn btn-success" type="submit">Add to Watch List</button>
      {% endif %}
  </form>
</div>

      {% endif %}
  </div>
</body>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  var ctx = document.getElementById('myChart').getContext('2d');
  var chart = new Chart(ctx, {
    type: 'doughnut',
    data: {
      labels: ['Score'],
      datasets: [{
        data: [
          {% if ratios.rClass == 'A' %}
          100,0
        {% elif ratios.rClass == 'B'%}
          75,25
        {% elif ratios.rClass == 'C'%}
          50,50
          {% elif ratios.rClass == 'D'%}
          25,75
        {% endif %}],
        backgroundColor: ['#FF6961', '#D3D3D3']
      }]
    },
    options: {
      plugins: {
        title: {
          display: true,
          text: '{{company.companyname}} Overall Recommendation', // Set the title text
          font: {
            size: 16, // Set the font size of the title
          },
        },
      },
      cutoutPercentage: 70,
      responsive: true,
      maintainAspectRatio: false,
      tooltips: {
        enabled: false
      },
      legend: {
        display: false
      }
    }
  });
</script>

<script>
  var ctx = document.getElementById('radarChart').getContext('2d');
  
  var chart = new Chart(ctx, {
    type: 'radar',
    data: {
      labels: ['Earnings Per Share', 'Price to Earnings', 'Return on Equity', 'Operating Margins', 
      'Diviend Yield', 'Payout Ratio'],
      datasets: [{
        label: 'Score',
        data: [
        {% if ratios.rEPS >= 10 %}
          100
        {% else %}
          Math.max({{ (ratios.rEPS / 10) * 100 }},0)
        {% endif %},
        {% if (ratios.rPE <= 10) and (ratios.rPE > 0) %}
          100
        {% elif ratios.rPE <= 50 and (ratios.rPE > 0)%}
          50
        {% else %}
          0
        {% endif %},
        {% if ratios.rROE >= 20 %}
          100
        {% else %}
        Math.max({{ (ratios.rROE / 20) * 100 }},0)
        {% endif %},
        {% if ratios.rOM >= 10 %}
          100
        {% else %}
        Math.max({{ (ratios.rOM / 10) * 100 }},0)
        {% endif %},
        {% if ratios.rDY >= 2 %}
          100
        {% else %}
          {{ (ratios.rDY / 2) * 100 }}
        {% endif %},
        {% if ratios.rPR >= 25 and ratios.rPR <= 75 %}
          100
          {% elif (ratios.rPR < 25 and ratios.rPR > 0 or ratios.rPR > 75 and ratios.rPR < 100)%}
          50
          {% else %}
          0
        {% endif %}
      ],
        backgroundColor: 'rgba(108, 160, 220, 0.5)',
        borderColor: 'rgba(108, 160, 220, 1)',
        pointBackgroundColor: 'rgba(108, 160, 220, 1)',
        pointBorderColor: '#fff',
        pointHoverBackgroundColor: '#fff',
        pointHoverBorderColor: 'rgba(108, 160, 220, 1)',
        borderWidth: 2,
      }]
    },
    options : {
       responsive: true,
       maintainAspectRatio: false,
       scales: {
          r: {
          min: 0, // MIN
          max: 100, // MAX
          beginAtZero: true,
          angleLines: {
             display: true,
             // color: 'red',
          },
          grid: {
           circular: true,
          },
          ticks: {
           stepSize: 50, // the number of step
          },
        },
      },
     }
  });
</script>

<script type="text/javascript">
        // Get the average monthly data from your Flask code
        var averageMonthlyData = {{ average_monthly_data | tojson }};

        // Extract labels (months) and data (average Close prices)
        var labels = Object.keys(averageMonthlyData);
        var data = Object.values(averageMonthlyData);

        // Create a Chart.js chart
        var ctx = document.getElementById('LineChart').getContext('2d');
        var chart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Average Close Price',
                    data: data,
                    fill: false,
                    borderColor: 'rgb(75, 192, 192)',
                    tension: 0.1
                }]
            },
    options: {
      plugins: {
        title: {
          display: true,
          text: '{{company.stock_name}} Monthly Stock Price', // Set the title text
          font: {
            size: 16, // Set the font size of the title
          },
        },
      },
      scale: {
        angleLines: {
          display: false,
        },
        ticks: {
          suggestedMin: 0, // Set the minimum value of the scale to 0
          suggestedMax: 1,
          stepSize: 0.2,
          backdropColor: 'rgba(255, 255, 255, 0)', // Hide the scale backdrop
          fontColor: '#333', // Scale label color
        },
        pointLabels: {
          fontColor: '#333', // Legend label color
        },
      },
      legend: {
        position: 'bottom',
        labels: {
          fontColor: '#333', // Legend label color
          usePointStyle: true,
        },
      },
      layout: {
        padding: {
          top: 10,
          bottom: 10,
          left: 10,
          right: 10,
        },
      },
      responsive: true,
      maintainAspectRatio: false,
    }
  });
</script>
<script type="text/javascript">
  $(document).ready(function() {
      $('#example').DataTable();
  });
</script>
{% endblock %}
